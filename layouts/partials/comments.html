{{/* Normalize the content path to match the data/comments directory */}}
{{ $path := .File.Path }}
{{ $path = replace $path "-" "_" }}
{{ $path = replace $path "." "_" }}

{{ $parts := split $path "/" }}
{{ $commentsFolder := site.Data.comments }}
{{ range $parts }}
  {{ $commentsFolder = index $commentsFolder . }}
{{ end }}

{{ if $commentsFolder }}
  {{/* Use Scratch to accumulate comments into a slice */}}
  {{ $.Scratch.Set "comments" (slice) }}
  {{ range $key, $comment := $commentsFolder }}
    {{ $.Scratch.Add "comments" (slice $comment) }}
  {{ end }}
  {{ $comments := $.Scratch.Get "comments" }}
  {{ $sorted := sort $comments "date" "desc" }}

  <div class="comments-container">
    <h2>Comments</h2>
    {{ range $comment := $sorted }}
      <div class="comment">
        <strong>{{ $comment.name }}</strong><br>
        <small>{{ $comment.date }}</small>
        <p>{{ $comment.message }}</p>
      </div>
    {{ end }}
  </div>
{{ else }}
  <p>No comments yet.</p>
{{ end }}
