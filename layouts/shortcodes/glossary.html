<input type="text" id="glossarySearch" placeholder="Search glossary..." onkeyup="filterGlossary()">

<div id="glossaryContainer">
  {{ range $term, $entry := site.Data.glossary }}
    <div class="glossary-entry" id="{{ $term | urlize }}">
      <h2>{{ $term }}</h2>
      {{- if reflect.IsMap $entry -}}
        {{- if $entry.short -}}
          <p><strong>Short definiton:</strong> {{ $entry.short }}</p>
        {{- end -}}
        <p><strong>Explanation: </strong>{{ $entry.explanation | markdownify }}</p>
        {{- if $entry.reference -}}
          <p><strong>Reference:</strong> {{ $entry.reference | safeHTML | markdownify }}</p>
        {{- end -}}
      {{- else -}}
        <p><strong>Short definition: </strong>{{ $entry | markdownify }}</p>
      {{- end -}}
    </div>
  {{ end }}
</div>

<script>
function highlightTermByHash() {
    const hash = window.location.hash;
    if (!hash) return;

    const term = document.querySelector(hash);
    if (!term) return;

    term.scrollIntoView({ behavior: "smooth" });

    term.style.transition = "none";
    term.style.background = "#fdf6c9";
    term.style.color = "#000";

    // Force reflow to restart transition
    term.offsetHeight;

    setTimeout(() => {
        term.style.transition = "background 1.5s ease-out, color 1.5s ease-out";
        term.style.background = "transparent";
        term.style.color = "";
    }, 100);
}

document.addEventListener("DOMContentLoaded", highlightTermByHash);
window.addEventListener("hashchange", highlightTermByHash);


function filterGlossary() {
    let input = document.getElementById("glossarySearch").value.toLowerCase();
    let terms = document.querySelectorAll(".glossary-entry");

    terms.forEach(term => {
        let text = term.textContent.toLowerCase();
        term.style.display = text.includes(input) ? "block" : "none";
    });
}
</script>
